MaxperCodecsBot - телеграм-бот, позволяющий ознакомиться с кодексами и некоторыми другими нормативными актами России.

Вы можете выбрать нормативный акт и прочитать нужную вам статью.

Вы можете добавлять закладки, нажимая на кнопку с номером текущей страницы.

**Команды**:

 - `/start` - запустить бота.
 - `/help` - справка по использованию.
 - `/continue` - продолжить чтение.
 - `/select` - выбрать нормативный акт.
 - `/bookmarks` - список закладок.


Бот использует базу данных PostgreSQL. Для её установки и настройки смотрите соответствующую документацию.
Вам необходимо создать базу данных для работы бота. Таблицы в базе данных создавать не нужно.

# Зависимости 

    Python 3.8+
    aiogram - для использования Telegram Bot API
    psycopg2 - для работы с базой данных
    asyncpg - для работы с базой данных
    SQLAlchemy - для работы с базой данных
    aiohttp - для http-запросов
    beautifulsoup4 - для обработки XML файлов
    lxml - для обработки XML файлов
    environs - для работы с переменными окружения
    aiofiles - для асинхронной работы с файлами

# Установка

1. Клонирование репозитория:

```bash
git clone https://github.com/maxper46/MaxperCodecsBot.git
```

2. Создание виртуального окружения и установка зависимостей:

```bash
cd MaxperCodecsBot
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```
3. Заполнить файл `.env.example` и переименовать его в `.env`.
В том числе внесите данные созданной базы данных {имя базы, имя пользователя, пароль). Предполагается, что база работает на локальной машине.
Если это не так - внесите правку в файл config.py (db_host и db_port)

4. Подготовка к запуску бота.
    Предварительно может быть нужно дать права на исполнение необходимых файлов:
```bash
chmod u+x setup.py
chmod u+x bot.py
chmod u+x update.py
```

Чтобы git не обращал внимания на изменение прав на файлы, введите:
```bash
git config core.filemode false
```

Запустите:

```bash
python setup.py
```
или
```bash
./setup.py
```
 
5. Запуск бота.
```bash
python bot.py
```
или
```bash
./bot.py
```

# Информация

1. Поскольку нормативные акты время от времени меняются,требуется периодическое обновление базы данных.
Для этого остановите бот и запустите:
```bash
python update.py
```
или
```bash
./update.py
```
Далее запустите бот как обычно.

2. Для корректной работы при первом использовании бота необходимо подать команду /start, если она почему-то не сработала.
3. В настоящее время пользователь, выбрав нормативный акт, должен ввести номер статьи, с которой хотел бы начать работу.
Некоторые номера статей могут содержать точку между цифрами. В КоАП РФ так сделано во всех номерах статей.
4. В будущем планируется дать возможность выбора главы нормативного акта, с которой начнётся работа.
5. Повторный запуск setup.py приведёт бот в первоначальное состояние: будут скачeны недостающие или обновлённые\
документы, таблицы базы данных будут созданы заново. Если вам нужно просто обновить нормативные акты, используйте update.py 
6. Команда /continue возвращает пользователя к последней просмотренной статье.
7. Автор, как обычно, ни за что не отвечает, но надеется, что бот будет кому-то полезным. :))

Автор: Максим В. Перехрест <maxper@list.ru>
